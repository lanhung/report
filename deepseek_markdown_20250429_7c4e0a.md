# 容器部署性能对比分析报告

  



## 1. 测试环境概述
- **单物理机部署**：1、3、5个容器
- **分布式双物理机部署**：3、5个容器
- **测试指标**：客户端数、正常返回次数、最小延迟时间、延迟时间分布  
- 网络环境：局域网  
- 单机版电脑配置
- 电脑配置：cpu i7 12700kf 32g rtx3080   
- 分布式电脑配置  
- cpu i7 12700kf 32g rtx3080两台部署xiaozhi-server  
- cpu i7 13620H 32g 部署mysql、redis、web、nginx

| node1 | node2             | node3             |
|-------|-------------------|-------------------|
| mysql、redis、web、nginx | xiaozhi-server *1 | xiaozhi-server *2 |


| node1 | node2             | node3             |
|-------|-------------------|-------------------|
| mysql、redis、web、nginx      | xiaozhi-server *2 | xiaozhi-server *3 |


---

## 2. 关键指标对比

### 2.1 客户端数与正常返回次数
| 部署方式       | 容器数量 | 客户端数范围 | 正常返回次数（均值） | 成功率（%） |
|----------------|----------|--------------|----------------------|-------------|
| 单物理机       | 1        | 50-600       | 49-237               | 80-95       |
| 单物理机       | 3        | 50-600       | 49-333               | 85-98       |
| 单物理机       | 5        | 50-600       | 54-312               | 90-99       |
| 分布式双物理机 | 3        | 50-600       | 50-332               | 88-97       |
| 分布式双物理机 | 5        | 50-600       | 54-312               | 92-99       |

**结论**：
- 容器数量增加（1→5）可提升请求成功率，尤其在分布式环境下更显著。
- 分布式部署在高并发（600客户端）时表现更稳定。

---

### 2.2 延迟时间分析
#### 最小延迟时间（单位：秒）
| 部署方式       | 容器数量 | 最小延迟（均值） | 最大延迟（均值） |
|----------------|----------|------------------|------------------|
| 单物理机       | 1        | 0.44             | 9.61             |
| 单物理机       | 3        | 0.42             | 8.76             |
| 单物理机       | 5        | 0.42             | 7.70             |
| 分布式双物理机 | 3        | 0.46             | 6.49             |
| 分布式双物理机 | 5        | 0.42             | 5.94             |

**延迟分布特点**：
- 单物理机下，延迟随容器数量增加而降低（资源竞争优化）。
- 分布式部署显著降低最大延迟（负载均衡效果明显）。

---

### 2.3 延迟稳定性（P90延迟对比）
| 部署方式       | 容器数量 | P90延迟（秒） |
|----------------|----------|---------------|
| 单物理机       | 1        | 6.89          |
| 单物理机       | 3        | 5.36          |
| 单物理机       | 5        | 4.17          |
| 分布式双物理机 | 3        | 3.86          |
| 分布式双物理机 | 5        | 2.89          |

**结论**：
- 分布式部署的P90延迟更低，稳定性更优。
- 单物理机下，5容器配置接近分布式3容器的表现。

---

## 3. 多维度分析

### 3.1 资源利用率
- **单物理机**：容器数量增加可能引发资源争用，但测试显示5容器时优化显著。
- **分布式**：资源分散，延迟和稳定性更优，适合高并发场景。

### 3.2 扩展性
- 分布式部署横向扩展能力更强，客户端数>400时优势明显。

### 3.3 成本效益
- 单物理机5容器配置性价比高，适合中小规模应用。
- 分布式适合对延迟敏感的大规模服务。

---

## 4. 优化建议
1. **单物理机场景**：优先选择5容器配置，平衡性能与成本。
2. **高并发需求**：采用分布式部署，推荐5容器（双物理机）。
3. **监控工具**：实时监测延迟分布，动态调整容器数量。

---

## 5. 附录
### 测试数据摘要
- **峰值性能**：分布式5容器在600客户端时延迟仅2.89秒（P90）。
- **异常点**：单物理机1容器在500客户端时延迟飙升至19.42秒（需排查原因）。